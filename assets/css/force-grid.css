/**
 * FORCE-GRID.CSS (VERSIÓN FINAL)
 * Estilos forzados para cuadrícula de productos WooCommerce
 * Optimizado para evitar elementos huérfanos y limitar a 3 filas exactas
 */

/* ===== 1. CONFIGURACIÓN BÁSICA DEL GRID ===== */
body ul.products,
body.woocommerce ul.products,
body.woocommerce-page ul.products,
body .woocommerce ul.products,
html body .productos-grid,
#main ul.products,
#content ul.products,
.woocommerce .products,
.wc-productos-template ul.products,
.productos-grid {
    /* Configuración principal del grid */
    display: grid !important;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)) !important;
    grid-template-rows: repeat(3, auto) !important;
    grid-auto-rows: 0px !important; /* Crucial: fuerza filas adicionales a tener altura cero */
    gap: 20px !important;
    
    /* Limitar altura y ocultar desbordamiento */
    max-height: 1500px !important; /* Valor seguro para tres filas en cualquier resolución */
    overflow: hidden !important;
    
    /* Resetear estilos que puedan interferir */
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 0 30px 0 !important;
    padding: 0 !important;
    list-style: none !important;
    float: none !important;
    clear: both !important;
    box-sizing: border-box !important;
    position: relative !important; /* Para posicionamiento absoluto de elementos huérfanos */
}

/* Eliminar flotadores y clearfix que pueden romper la cuadrícula */
body ul.products::before,
body ul.products::after,
body.woocommerce ul.products::before,
body.woocommerce ul.products::after,
.woocommerce .products::before,
.woocommerce .products::after,
.productos-grid::before,
.productos-grid::after {
    display: none !important;
    content: none !important;
    clear: none !important;
}

/* Estilo base para cada producto */
body ul.products li.product,
body.woocommerce ul.products li.product,
body.woocommerce-page ul.products li.product,
body .woocommerce ul.products li.product,
html body .productos-grid li.product,
#main ul.products li.product,
#content ul.products li.product,
.woocommerce .products li.product,
.wc-productos-template ul.products li.product,
.productos-grid li.product {
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 0 20px 0 !important;
    padding: 0 !important;
    float: none !important;
    clear: none !important;
    box-sizing: border-box !important;
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important; /* Asegurar altura completa */
    opacity: 1 !important; /* Asegurar visibilidad */
    position: relative !important;
    visibility: visible !important;
}



/* ===== 3. CONTROL DE FILAS (PANTALLAS GRANDES - 4 COLUMNAS) ===== */
@media (min-width: 992px) {
    /* Asegurar que los primeros 12 productos (4x3) se muestren */
    body ul.products li.product:nth-child(-n+12),
    body.woocommerce ul.products li.product:nth-child(-n+12),
    body.woocommerce-page ul.products li.product:nth-child(-n+12),
    body .woocommerce ul.products li.product:nth-child(-n+12),
    .wc-productos-template ul.products li.product:nth-child(-n+12),
    .productos-grid li.product:nth-child(-n+12) {
        display: flex !important;
        visibility: visible !important;
        height: auto !important;
    }
    
    /* Ocultar cualquier producto después del 12 (4 columnas x 3 filas) */
    body ul.products li.product:nth-child(n+13),
    body.woocommerce ul.products li.product:nth-child(n+13),
    body.woocommerce-page ul.products li.product:nth-child(n+13),
    body .woocommerce ul.products li.product:nth-child(n+13),
    .wc-productos-template ul.products li.product:nth-child(n+13),
    .productos-grid li.product:nth-child(n+13),
    /* También ocultar divs dentro de estos productos */
    body ul.products li.product:nth-child(n+13) *,
    body.woocommerce ul.products li.product:nth-child(n+13) *,
    body.woocommerce-page ul.products li.product:nth-child(n+13) *,
    body .woocommerce ul.products li.product:nth-child(n+13) *,
    .wc-productos-template ul.products li.product:nth-child(n+13) *,
    .productos-grid li.product:nth-child(n+13) * {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        width: 0 !important;
        overflow: hidden !important;
        position: absolute !important;
        z-index: -9999 !important;
        opacity: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
    }
}

/* ===== 4. CONTROL DE FILAS (PANTALLAS MEDIANAS - 3 COLUMNAS) ===== */
@media (max-width: 991px) and (min-width: 769px) {
    /* Ajustar grid para 3 columnas */
    body ul.products,
    body.woocommerce ul.products,
    body.woocommerce-page ul.products,
    body .woocommerce ul.products,
    .wc-productos-template ul.products,
    .productos-grid {
        grid-template-columns: repeat(3, 1fr) !important;
    }
    
    /* Mostrar solo los primeros 9 productos (3x3) */
    body ul.products li.product:nth-child(-n+9),
    body.woocommerce ul.products li.product:nth-child(-n+9),
    body.woocommerce-page ul.products li.product:nth-child(-n+9),
    body .woocommerce ul.products li.product:nth-child(-n+9),
    .wc-productos-template ul.products li.product:nth-child(-n+9),
    .productos-grid li.product:nth-child(-n+9) {
        display: flex !important;
        visibility: visible !important;
        height: auto !important;
    }
    
    /* Ocultar desde el producto 10 en adelante */
    body ul.products li.product:nth-child(n+10),
    body.woocommerce ul.products li.product:nth-child(n+10),
    body.woocommerce-page ul.products li.product:nth-child(n+10),
    body .woocommerce ul.products li.product:nth-child(n+10),
    .wc-productos-template ul.products li.product:nth-child(n+10),
    .productos-grid li.product:nth-child(n+10),
    /* También ocultar divs dentro de estos productos */
    body ul.products li.product:nth-child(n+10) *,
    body.woocommerce ul.products li.product:nth-child(n+10) *,
    body.woocommerce-page ul.products li.product:nth-child(n+10) *,
    body .woocommerce ul.products li.product:nth-child(n+10) *,
    .wc-productos-template ul.products li.product:nth-child(n+10) *,
    .productos-grid li.product:nth-child(n+10) * {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        width: 0 !important;
        overflow: hidden !important;
        position: absolute !important;
        z-index: -9999 !important;
        opacity: 0 !important;
    }
}

/* ===== 5. CONTROL DE FILAS (PANTALLAS PEQUEÑAS - 2 COLUMNAS) ===== */
@media (max-width: 768px) {
    /* Ajustar grid para 2 columnas */
    body ul.products,
    body.woocommerce ul.products,
    body.woocommerce-page ul.products,
    body .woocommerce ul.products,
    .wc-productos-template ul.products,
    .productos-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 15px !important;
    }
    
    /* Mostrar solo los primeros 6 productos (2x3) */
    body ul.products li.product:nth-child(-n+6),
    body.woocommerce ul.products li.product:nth-child(-n+6),
    body.woocommerce-page ul.products li.product:nth-child(-n+6),
    body .woocommerce ul.products li.product:nth-child(-n+6),
    .wc-productos-template ul.products li.product:nth-child(-n+6),
    .productos-grid li.product:nth-child(-n+6) {
        display: flex !important;
        visibility: visible !important;
        height: auto !important;
    }
    
    /* Ocultar desde el producto 7 en adelante */
    body ul.products li.product:nth-child(n+7),
    body.woocommerce ul.products li.product:nth-child(n+7),
    body.woocommerce-page ul.products li.product:nth-child(n+7),
    body .woocommerce ul.products li.product:nth-child(n+7),
    .wc-productos-template ul.products li.product:nth-child(n+7),
    .productos-grid li.product:nth-child(n+7),
    /* También ocultar divs dentro de estos productos */
    body ul.products li.product:nth-child(n+7) *,
    body.woocommerce ul.products li.product:nth-child(n+7) *,
    body.woocommerce-page ul.products li.product:nth-child(n+7) *,
    body .woocommerce ul.products li.product:nth-child(n+7) *,
    .wc-productos-template ul.products li.product:nth-child(n+7) *,
    .productos-grid li.product:nth-child(n+7) * {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        width: 0 !important;
        overflow: hidden !important;
        position: absolute !important;
        z-index: -9999 !important;
        opacity: 0 !important;
    }
}

/* ===== 6. AJUSTES PARA DISPOSITIVOS MUY PEQUEÑOS ===== */
@media (max-width: 480px) {
    body ul.products,
    body.woocommerce ul.products,
    body.woocommerce-page ul.products,
    body .woocommerce ul.products,
    .wc-productos-template ul.products,
    .productos-grid {
        grid-template-columns: repeat(2, 1fr) !important; /* Mantener 2 columnas */
        gap: 10px !important; /* Reducir el espacio entre items */
    }
    
    /* Ajustar detalles visuales para pantallas pequeñas */
    body ul.products li.product,
    body.woocommerce ul.products li.product,
    body.woocommerce-page ul.products li.product,
    body .woocommerce ul.products li.product,
    .wc-productos-template ul.products li.product,
    .productos-grid li.product {
        margin-bottom: 15px !important;
    }
}

/* ===== 7. SOLUCIÓN FINAL PARA ELEMENTOS HUÉRFANOS ===== */
/* Esta sección es crucial para evitar que aparezcan bloques huérfanos */

/* Ocultar cualquier div.producto-interior que no sea descendiente directo de un li.product */
html body div.producto-interior:not(li.product > div.producto-interior) {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    width: 0 !important;
    position: absolute !important;
    z-index: -9999 !important;
    opacity: 0 !important;
    pointer-events: none !important;
    overflow: hidden !important;
}

/* Regla universal para cualquier elemento huérfano en la estructura de productos */
html body .wc-productos-template *:empty,
html body .productos-grid *:empty,
html body ul.products *:empty {
    display: none !important;
    height: 0 !important;
    width: 0 !important;
}

/* Selectores de último recurso para cualquier elemento huérfano */
html body div.wc-productos-template > div:not(.productos-container):not(.productos-layout):not(.productos-main):not(.productos-sidebar),
html body main > div:not(.wc-productos-template):not(.entry-content):not(.site-main):empty {
    display: none !important;
    height: 0 !important;
    width: 0 !important;
    visibility: hidden !important;
}
